<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>VINCLE ‚Äî Conversaci√≥n an√≥nima</title>
<style>
:root {
  --bg: #0f1720;
  --card: #0b1220;
  --accent: #60a5fa;
  --accent-hover: #3b82f6;
  --muted: #94a3b8;
  --bubble: #111827;
  --bubble-other: #1e293b;
  --glass: rgba(255,255,255,0.03);
  --border: rgba(255,255,255,0.05);
  color-scheme: dark;
}
* { box-sizing: border-box; margin:0; padding:0; }
html, body { height:100%; font-family: 'Inter', sans-serif; overflow:hidden; background: linear-gradient(135deg, #071028 0%, #0a1426 100%); display:flex; justify-content:center; align-items:center; position:relative; }
body::before { content:''; position:fixed; top:0; left:0; width:100%; height:100%; background-image: radial-gradient(circle at 20% 80%, rgba(96, 165, 250, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.03) 0%, transparent 50%); z-index:-1; }

/* HEADER */
header {
  position: fixed; top:0; left:0; right:0; height:60px;
  background: rgba(11,18,32,0.95); backdrop-filter: blur(20px); border-bottom:1px solid var(--border);
  display:flex; align-items:center; justify-content:space-between; padding:0 16px; z-index:1000; color:#e6eef8;
}
.header-brand { display:flex; align-items:center; gap:12px; text-decoration:none; }
.logo { width:36px; height:36px; border-radius:10px; background: linear-gradient(135deg, var(--accent), #7dd3fc); display:flex; align-items:center; justify-content:center; font-weight:700; color:#021; box-shadow:0 4px 15px rgba(96,165,250,0.3); transition: transform 0.3s; }
.logo:hover { transform: scale(1.05); }
.header-title { font-size:18px; font-weight:600; letter-spacing:-0.01em; }
.header-subtitle { font-size:12px; color:var(--muted); margin-top:2px; }
.header-actions { display:flex; align-items:center; gap:8px; }
.header-btn { padding:8px 12px; border-radius:8px; border:1px solid var(--border); background: rgba(255,255,255,0.03); color:var(--muted); cursor:pointer; font-size:14px; font-weight:500; display:flex; align-items:center; gap:4px; transition: all 0.2s ease; }
.header-btn:hover { background: rgba(255,255,255,0.06); color:#e6eef8; border-color: rgba(255,255,255,0.1); }
.header-btn.accent { background:var(--accent); color:#021; border:none; }
.header-btn.accent:hover { background:var(--accent-hover); transform:translateY(-1px); box-shadow:0 4px 12px rgba(96,165,250,0.3); }

/* MENU M√ìVIL */
#menuBtn { display:none; font-size:20px; }

/* APP CONTAINER */
.app-container { width:100%; max-width:1200px; height:calc(100dvh - 60px); margin-top:60px; padding:24px; display:grid; grid-template-columns:320px 1fr; gap:24px; position:relative; }

/* PANEL LATERAL */
.side-panel {
  background: rgba(11,18,32,0.9); backdrop-filter: blur(10px); border-radius:16px; border:1px solid var(--border);
  padding:24px; height:100%; display:flex; flex-direction:column; overflow-y:auto; box-shadow:0 8px 32px rgba(0,0,0,0.2); transition: all 0.3s ease;
}
.side-panel .panel-section { margin-bottom:24px; }
.side-panel .panel-section:last-of-type { margin-bottom:0; margin-top:auto; }
.section-title { font-size:14px; color:var(--muted); margin-bottom:12px; font-weight:500; text-transform:uppercase; letter-spacing:0.02em; }

/* Identity */
.identity-badge { display:flex; align-items:center; gap:12px; padding:14px; background:var(--glass); border-radius:12px; border:1px solid var(--border); }
.emoji-large { font-size:24px; width:44px; height:44px; display:flex; align-items:center; justify-content:center; background: rgba(255,255,255,0.03); border-radius:10px; }
.color-dot { width:20px; height:20px; border-radius:50%; border:2px solid rgba(255,255,255,0.1); }
.identity-info { flex:1; }
.identity-name { font-weight:600; font-size:16px; color:#e6eef8; }
.identity-sub { font-size:12px; color:var(--muted); margin-top:2px; }

/* Inputs y botones */
.styled-input { width:100%; padding:12px 16px; border-radius:10px; border:1px solid var(--border); background: rgba(255,255,255,0.02); color:#e6eef8; font-size:15px; transition: all 0.2s; }
.styled-input:focus { outline:none; border-color:var(--accent); background: rgba(255,255,255,0.03); box-shadow:0 0 0 3px rgba(96,165,250,0.1);}
.button-group { display:flex; gap:10px; margin-top:16px; }
.btn-primary { flex:1; padding:12px; border-radius:10px; border:none; background:var(--accent); color:#021; font-weight:600; cursor:pointer; transition: all 0.2s; }
.btn-primary:hover { background:var(--accent-hover); transform:translateY(-1px); box-shadow:0 4px 12px rgba(96,165,250,0.3);}
.btn-secondary { padding:12px 20px; border-radius:10px; border:1px solid var(--border); background:transparent; color:var(--muted); cursor:pointer; transition: all 0.2s; }
.btn-secondary:hover { background: rgba(255,255,255,0.03); color:#e6eef8; border-color: rgba(255,255,255,0.1); }

/* CHAT */
.chat-container { background: rgba(11,18,32,0.8); backdrop-filter: blur(10px); border-radius:16px; border:1px solid var(--border); display:flex; flex-direction:column; height:100%; overflow:hidden; box-shadow:0 8px 32px rgba(0,0,0,0.2); }
.chat-header { padding:20px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; flex-shrink:0; }
.messages-area { flex:1; padding:24px; overflow-y:auto; display:flex; flex-direction:column; gap:16px; scroll-behavior:smooth; background:linear-gradient(180deg, rgba(255,255,255,0.01)0%,transparent 30%,transparent 100%);}
.message-bubble { max-width:75%; padding:16px 20px; border-radius:18px; position:relative; line-height:1.5; word-break:break-word; animation: messageAppear 0.3s ease-out; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
.message-bubble.mine { align-self:flex-end; background:linear-gradient(135deg, var(--accent), #7dd3fc); color:#021; border-bottom-right-radius:6px; }
.message-bubble.other { align-self:flex-start; background:var(--bubble-other); border-bottom-left-radius:6px; }
@keyframes messageAppear { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

/* Composer */
.message-composer { padding:20px; border-top:1px solid var(--border); display:flex; gap:12px; align-items:center; flex-shrink:0; background: rgba(11,18,32,0.9);}
.composer-input { flex:1; padding:14px 18px; border-radius:12px; border:1px solid var(--border); background: rgba(255,255,255,0.02); color:#e6eef8; font-size:15px; resize:none; min-height:48px; max-height:120px; line-height:1.5; transition:all 0.2s;}
.composer-input:focus{outline:none; border-color:var(--accent); background: rgba(255,255,255,0.03); box-shadow:0 0 0 3px rgba(96,165,250,0.1);}
.send-button { padding:14px 24px; border-radius:12px; border:none; background:var(--accent); color:#021; font-weight:600; cursor:pointer; display:flex; align-items:center; gap:8px; min-width:100px; justify-content:center;}
.send-button:hover:not(:disabled){background:var(--accent-hover); transform:translateY(-1px); box-shadow:0 4px 12px rgba(96,165,250,0.3);}
.send-button:disabled{opacity:0.5; cursor:not-allowed;}

/* STATS */
.stats-bar { display:flex; align-items:center; gap:16px; padding:12px; border-top:1px solid var(--border); background: rgba(11,18,32,0.9); font-size:13px; color:var(--muted); }
.stat-item { display:flex; align-items:center; gap:6px; }

/* RESPONSIVE */
@media(max-width:1024px){
  .app-container { grid-template-columns:1fr; padding:8px; gap:8px; }
  .side-panel { position:fixed; top:60px; left:-100%; width:80%; height:calc(100dvh-60px); z-index:1500; transition: left 0.3s ease; overflow-y:auto; }
  .side-panel.active{ left:0; }
  #menuBtn{ display:block; }
}
</style>
</head>
<body>

<header>
  <a href="#" class="header-brand">
    <div class="logo">üî∑</div>
    <div>
      <div class="header-title">VINCLE</div>
      <div class="header-subtitle">Chat an√≥nimo ‚Ä¢ Sin registro</div>
    </div>
  </a>
  <div class="header-actions">
    <button id="menuBtn">‚ò∞</button>
    <button id="newRoomBtn" class="header-btn accent">‚ú®<span>Nueva sala</span></button>
  </div>
</header>

<div class="app-container">
  <aside class="side-panel" id="sidePanel">
    <!-- Secciones id√©nticas a desktop -->
    <div class="panel-section">
      <h3 class="section-title">Tu identidad</h3>
      <div class="identity-badge">
        <div class="emoji-large" id="myEmoji">üî∑</div>
        <div class="color-dot" id="myColor"></div>
        <div class="identity-info">
          <div class="identity-name" id="anonLabel">An√≥nimo</div>
          <div class="identity-sub">Color y emoji √∫nicos</div>
        </div>
      </div>
    </div>
    <div class="panel-section">
      <h3 class="section-title">Gestionar sala</h3>
      <div class="room-controls">
        <input type="text" id="roomInput" class="styled-input" placeholder="Introduce ID o genera uno">
        <div class="button-group">
          <button id="createBtn" class="btn-primary">Unirse/Crear</button>
          <button id="copyBtn" class="btn-secondary">Copiar enlace</button>
        </div>
        <div style="font-size:12px;color:var(--muted);margin-top:12px;line-height:1.4;">
          Comparte el enlace. Los mensajes se borran autom√°ticamente despu√©s de 24h.
        </div>
      </div>
    </div>
    <div class="panel-section">
      <h3 class="section-title">Acciones r√°pidas</h3>
      <div style="display:flex;flex-direction:column;gap:8px;">
        <button id="clearChatBtn" class="btn-secondary">üóëÔ∏è Limpiar chat local</button>
        <button id="randomRoomBtn" class="btn-secondary">üé≤ Sala aleatoria</button>
        <button id="shareRoomBtn" class="btn-secondary">üì§ Compartir sala</button>
      </div>
    </div>
    <div class="panel-section">
      <div class="stats-bar">
        <div class="stat-item">üïí Expira en <span id="expiryLabel">24h</span></div>
        <div class="stat-item">üë§ <span id="onlineCount">1 en l√≠nea</span></div>
      </div>
    </div>
  </aside>

  <main class="chat-container">
    <div class="chat-header">
      <div>Sala: <span id="roomTitle">Cargando...</span></div>
    </div>
    <div class="messages-area" id="messages"></div>
    <div class="message-composer">
      <textarea id="textInput" class="composer-input" placeholder="Escribe tu mensaje..."></textarea>
      <button id="sendBtn" class="send-button">Enviar ‚Üó</button>
    </div>
  </main>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
// --- Firebase ---
const firebaseConfig = { apiKey: "AIza...", authDomain: "vincle-e76dd.firebaseapp.com", databaseURL: "https://vincle-e76dd-default-rtdb.firebaseio.com", projectId: "vincle-e76dd", storageBucket: "vincle-e76dd.appspot.com", messagingSenderId: "11807936515", appId:"1:11807936515:web:ff67d9da38e956ff62cee6" };
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// --- Variables ---
const COLORS=['#f97316','#fb7185','#60a5fa','#34d399','#f59e0b','#a78bfa','#ef4444'];
const EMOJIS=['üî∑','üî∂','üî∫','üîµ','üü£','üü¢','üåø','‚ú®','‚ö°','üåô','‚òÄÔ∏è','üî•'];
const MESSAGE_EXPIRY_HOURS=24;

const myColorEl=document.getElementById('myColor');
const myEmojiEl=document.getElementById('myEmoji');
const roomInput=document.getElementById('roomInput');
const createBtn=document.getElementById('createBtn');
const copyBtn=document.getElementById('copyBtn');
const messagesEl=document.getElementById('messages');
const textInput=document.getElementById('textInput');
const sendBtn=document.getElementById('sendBtn');
const newRoomBtn=document.getElementById('newRoomBtn');
const clearChatBtn=document.getElementById('clearChatBtn');
const randomRoomBtn=document.getElementById('randomRoomBtn');
const shareRoomBtn=document.getElementById('shareRoomBtn');
const expiryLabel=document.getElementById('expiryLabel');
const roomTitle=document.getElementById('roomTitle');
const sidePanel=document.getElementById('sidePanel');
const menuBtn=document.getElementById('menuBtn');

// --- Identidad ---
const pickRandom=a=>a[Math.floor(Math.random()*a.length)];
const sessionColor=sessionStorage.getItem('vincle_color')||pickRandom(COLORS);
const sessionEmoji=sessionStorage.getItem('vincle_emoji')||pickRandom(EMOJIS);
sessionStorage.setItem('vincle_color',sessionColor);
sessionStorage.setItem('vincle_emoji',sessionEmoji);
myColorEl.style.background=sessionColor; myEmojiEl.textContent=sessionEmoji;

// --- Sala ---
const urlParams=new URLSearchParams(window.location.search);
let currentRoom=urlParams.get('room')||localStorage.getItem('vincle_room')||Math.random().toString(36).substring(2,9);
function setRoom(r){ currentRoom=r; roomTitle.textContent=r; roomInput.value=r; localStorage.setItem('vincle_room',r); expiryLabel.textContent=MESSAGE_EXPIRY_HOURS+'h'; listenToMessages(); }

// --- Firebase ---
function getMessagesRef(){ return database.ref('rooms/'+currentRoom+'/messages'); }
function sendMessage(text){ if(!text.trim())return; const now=Date.now(); const msg={text:text.trim(),color:sessionColor,emoji:sessionEmoji,ts:now,expiry:now+MESSAGE_EXPIRY_HOURS*3600000}; getMessagesRef().push(msg); textInput.value=''; textInput.style.height='auto'; }
function createMessageBubble(msg,isMine){ const b=document.createElement('div'); b.className='message-bubble '+(isMine?'mine':'other'); const timeStr=formatTime(new Date(msg.ts||Date.now())); b.innerHTML=`<div class="message-sender"><span class="sender-emoji">${msg.emoji||'üë§'}</span><span class="sender-name">${isMine?'T√∫':'An√≥nimo'}</span></div><div class="message-text">${escapeHtml(msg.text)}</div><div class="message-time">${timeStr}</div>`; return b; }
function listenToMessages(){ messagesEl.innerHTML=''; getMessagesRef().limitToLast(100).on('child_added',s=>{ const msg=s.val(); if(!msg)return; if(msg.expiry && Date.now()>msg.expiry)return; const mine=(msg.color===sessionColor && msg.emoji===sessionEmoji); messagesEl.appendChild(createMessageBubble(msg,mine)); setTimeout(()=>messagesEl.scrollTop=messagesEl.scrollHeight,100); }); }
function escapeHtml(t){ const d=document.createElement('div'); d.textContent=t; return d.innerHTML; }
function formatTime(d){ const diff=Date.now()-d; if(diff<60000)return'Ahora'; if(diff<3600000)return`${Math.floor(diff/60000)} min`; if(diff<86400000)return d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}); return d.toLocaleDateString([], {month:'short',day:'numeric'}); }

// --- Eventos ---
createBtn.addEventListener('click',()=>setRoom(roomInput.value.trim()||Math.random().toString(36).substring(2,9)));
copyBtn.addEventListener('click',()=>navigator.clipboard.writeText(window.location.href).then(()=>alert('Enlace copiado')));
sendBtn.addEventListener('click',()=>sendMessage(textInput.value));
textInput.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage(textInput.value);}});
textInput.addEventListener('input',function(){this.style.height='auto';this.style.height=this.scrollHeight+'px';});
newRoomBtn.addEventListener('click',()=>setRoom(Math.random().toString(36).substring(2,9)));
clearChatBtn.addEventListener('click',()=>{if(confirm('Limpiar chat local?')){messagesEl.innerHTML='';listenToMessages();}});
randomRoomBtn.addEventListener('click',()=>setRoom(Math.random().toString(36).substring(2,9)));
shareRoomBtn.addEventListener('click',()=>{navigator.clipboard.writeText(window.location.href).then(()=>alert('Enlace copiado.'))});
menuBtn.addEventListener('click',()=>sidePanel.classList.toggle('active'));

document.addEventListener('DOMContentLoaded',()=>{ setRoom(currentRoom); setTimeout(()=>textInput.focus(),500); });
</script>

</body>
</html>
