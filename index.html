<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>VINCLE ‚Äî Chat estilo WhatsApp</title>
<style>
:root {
  --bg: #0f1720;
  --panel-bg: #111827;
  --accent: #25d366;
  --accent-hover: #20b858;
  --text: #e6eef8;
  --muted: #94a3b8;
  --bubble: #1e293b;
  --bubble-mine: #25d366;
  --border: rgba(255,255,255,0.05);
}

*{margin:0;padding:0;box-sizing:border-box;}
body,html{height:100%;font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);}
body{display:flex;overflow:hidden;}
a{text-decoration:none;color:inherit;}

/* === HEADER === */
header{
  position:fixed;top:0;left:0;right:0;height:60px;
  background:var(--panel-bg);display:flex;align-items:center;justify-content:space-between;
  padding:0 16px;z-index:1000;border-bottom:1px solid var(--border);
}
.header-brand{display:flex;align-items:center;gap:12px;}
.logo{width:36px;height:36px;border-radius:10px;background:var(--accent);display:flex;align-items:center;justify-content:center;font-weight:700;color:#021;}
.header-title{font-size:18px;font-weight:600;}
.header-subtitle{font-size:12px;color:var(--muted);}
.header-actions{display:flex;align-items:center;gap:12px;}
.header-btn{padding:8px 12px;border-radius:8px;border:1px solid var(--border);background:rgba(255,255,255,0.03);color:var(--muted);cursor:pointer;font-size:14px;display:flex;align-items:center;gap:6px;transition:all 0.2s;}
.header-btn:hover{background:rgba(255,255,255,0.06);color:var(--text);}
.header-btn.accent{background:var(--accent);color:#021;border:none;}
.header-btn.accent:hover{background:var(--accent-hover);transform:translateY(-1px);box-shadow:0 4px 12px rgba(37,215,102,0.3);}
#menuBtn{display:none;}

/* === APP CONTAINER === */
.app-container{display:flex;width:100%;height:100vh;margin-top:60px;transition:all 0.3s;}
.side-panel{
  width:320px;background:var(--panel-bg);border-right:1px solid var(--border);
  display:flex;flex-direction:column;overflow-y:auto;transition:transform 0.3s ease,opacity 0.3s ease;
  padding:16px;
}
.side-panel.hidden{transform:translateX(-100%);opacity:0;position:absolute;z-index:200;height:100%;top:60px;left:0;border-right:none;}
.panel-section{margin-bottom:24px;}
.section-title{font-size:14px;color:var(--muted);margin-bottom:12px;font-weight:500;text-transform:uppercase;}
.identity-badge{display:flex;align-items:center;gap:12px;padding:12px;background:rgba(255,255,255,0.03);border-radius:12px;border:1px solid var(--border);}
.emoji-large{font-size:24px;width:40px;height:40px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.03);border-radius:10px;}
.color-dot{width:20px;height:20px;border-radius:50%;border:2px solid rgba(255,255,255,0.1);}
.identity-info{flex:1;}
.identity-name{font-weight:600;font-size:16px;color:var(--text);}
.identity-sub{font-size:12px;color:var(--muted);}
.room-controls .styled-input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:rgba(255,255,255,0.02);color:var(--text);}
.button-group{display:flex;gap:10px;margin-top:10px;}
.btn-primary{flex:1;padding:10px;border-radius:10px;border:none;background:var(--accent);color:#021;cursor:pointer;}
.btn-primary:hover{background:var(--accent-hover);}
.btn-secondary{padding:10px;border-radius:10px;border:1px solid var(--border);background:transparent;color:var(--muted);cursor:pointer;}
.btn-secondary:hover{background:rgba(255,255,255,0.03);color:var(--text);}
.stats-bar{display:flex;flex-direction:column;gap:8px;font-size:13px;color:var(--muted);padding:8px 0;}
.stat-item{display:flex;align-items:center;gap:6px;}
.divider{height:1px;background:var(--border);margin:16px 0;}

/* === CHAT CONTAINER === */
.chat-container{flex:1;display:flex;flex-direction:column;height:100%;background:var(--panel-bg);}
.chat-header{padding:16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;}
.room-name{font-weight:600;font-size:16px;color:var(--text);}
.messages-area{flex:1;padding:16px;overflow-y:auto;display:flex;flex-direction:column;gap:12px;background:linear-gradient(180deg,rgba(255,255,255,0.01)0%,transparent 30%,transparent 100%);}
.message-bubble{max-width:75%;padding:12px 16px;border-radius:18px;position:relative;line-height:1.4;word-break:break-word;animation:messageAppear 0.3s;}
.message-bubble.mine{align-self:flex-end;background:var(--bubble-mine);color:#021;border-bottom-right-radius:6px;}
.message-bubble.other{align-self:flex-start;background:var(--bubble);border-bottom-left-radius:6px;color:#e6eef8;}
.message-sender{display:flex;align-items:center;gap:6px;margin-bottom:4px;font-size:13px;}
.message-text{font-size:14px;line-height:1.4;}
.message-time{font-size:11px;opacity:0.7;margin-top:4px;text-align:right;}
@keyframes messageAppear{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}

/* === MESSAGE COMPOSER === */
.message-composer{padding:12px;display:flex;gap:8px;align-items:center;border-top:1px solid var(--border);}
.composer-input{flex:1;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,0.02);color:var(--text);resize:none;min-height:40px;max-height:100px;}
.composer-input:focus{outline:none;border-color:var(--accent);}
.send-button{padding:10px 16px;border-radius:12px;border:none;background:var(--accent);color:#021;cursor:pointer;}
.send-button:hover{background:var(--accent-hover);transform:translateY(-1px);box-shadow:0 4px 12px rgba(37,215,102,0.3);}

/* === MOBILE RESPONSIVE === */
@media (max-width:768px){
  .side-panel{position:absolute;top:60px;left:0;height:100%;z-index:200;width:80%;max-width:300px;transform:translateX(-100%);opacity:0;transition:transform 0.3s,opacity 0.3s;}
  .side-panel.active{transform:translateX(0);opacity:1;background:var(--panel-bg);}
  #menuBtn{display:flex;}
  .app-container{flex-direction:column;}
  .chat-container{flex:1;}
}

/* === SCROLLBAR === */
.messages-area::-webkit-scrollbar{width:6px;}
.messages-area::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:3px;}
.messages-area::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,0.2);}
.side-panel::-webkit-scrollbar{width:6px;}
.side-panel::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:3px;}
</style>
</head>
<body>

<header>
  <div class="header-brand">
    <div class="logo">V</div>
    <div>
      <div class="header-title">VINCLE</div>
      <div class="header-subtitle">Chat an√≥nimo ‚Ä¢ Sin registro</div>
    </div>
  </div>
  <div class="header-actions">
    <button id="menuBtn" class="header-btn">‚ò∞</button>
    <button id="newRoomBtn" class="header-btn accent">‚ú® Nueva sala</button>
  </div>
</header>
<br>
  <br>
<div class="app-container">
  <aside class="side-panel" id="sidePanel">
    <div class="panel-section">
      <h3 class="section-title">Tu identidad</h3>
      <div class="identity-badge">
        <div class="emoji-large" id="myEmoji">üî∑</div>
        <div class="color-dot" id="myColor"></div>
        <div class="identity-info">
          <div class="identity-name" id="anonLabel">An√≥nimo</div>
          <div class="identity-sub">Color y emoji √∫nicos</div>
        </div>
      </div>
    </div>

    <div class="panel-section">
      <h3 class="section-title">Gestionar sala</h3>
      <input type="text" id="roomInput" class="styled-input" placeholder="Introduce ID o genera uno">
      <div class="button-group">
        <button id="createBtn" class="btn-primary">Unirse/Crear</button>
        <button id="copyBtn" class="btn-secondary">Copiar enlace</button>
      </div>
    </div>

    <div class="divider"></div>

    <div class="panel-section">
      <h3 class="section-title">Acciones r√°pidas</h3>
      <div style="display:flex;flex-direction:column;gap:8px;">
        <button id="clearChatBtn" class="btn-secondary">üóëÔ∏è Limpiar chat local</button>
        <button id="randomRoomBtn" class="btn-secondary">üé≤ Sala aleatoria</button>
        <button id="shareRoomBtn" class="btn-secondary">üì§ Compartir sala</button>
      </div>
    </div>

    <div class="divider"></div>

    <div class="panel-section stats-bar">
      <div class="stat-item">üïí Expira en <span id="expiryLabel">24h</span></div>
      <div class="stat-item">üë§ <span id="onlineCount">1</span> en l√≠nea</div>
    </div>
  </aside>

  <main class="chat-container">
    <div class="chat-header">
      <div class="room-name">Sala: <span id="roomTitle">Cargando...</span></div>
    </div>
    <div class="messages-area" id="messages"></div>
    <div class="message-composer">
      <textarea id="textInput" class="composer-input" placeholder="Escribe tu mensaje..."></textarea>
      <button id="sendBtn" class="send-button">Enviar</button>
    </div>
  </main>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
// --- Firebase ---
const firebaseConfig = {
  apiKey: "AIzaSyXMvncuf1Jhux5dVzDJ_VQe3cw3tIntt",
  authDomain: "vincle-e76dd.firebaseapp.com",
  databaseURL: "https://vincle-e76dd-default-rtdb.firebaseio.com",
  projectId: "vincle-e76dd",
  storageBucket: "vincle-e76dd.firebasestorage.app",
  messagingSenderId: "11807936515",
  appId: "1:11807936515:web:ff67d9da38e956ff62cee6"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- Constantes ---
const COLORS=['#f97316','#fb7185','#60a5fa','#34d399','#f59e0b','#a78bfa','#ef4444'];
const EMOJIS=['üî∑','üî∂','üî∫','üîµ','üü£','üü¢','üåø','‚ú®','‚ö°','üåô','‚òÄÔ∏è','üî•'];
const MESSAGE_EXPIRY_HOURS=24;

// --- DOM ---
const q=id=>document.getElementById(id);
const roomInput=q('roomInput'),createBtn=q('createBtn'),copyBtn=q('copyBtn');
const messagesEl=q('messages'),textInput=q('textInput'),sendBtn=q('sendBtn');
const roomTitle=q('roomTitle'),myColorEl=q('myColor'),myEmojiEl=q('myEmoji');
const clearChatBtn=q('clearChatBtn'),randomRoomBtn=q('randomRoomBtn');
const newRoomBtn=q('newRoomBtn'),shareRoomBtn=q('shareRoomBtn');
const expiryLabel=q('expiryLabel'),onlineCount=q('onlineCount');
const sidePanel=q('sidePanel'),menuBtn=q('menuBtn');

// --- Identidad ---
let sessionColor=sessionStorage.getItem('vincle_color')||COLORS[Math.floor(Math.random()*COLORS.length)];
let sessionEmoji=sessionStorage.getItem('vincle_emoji')||EMOJIS[Math.floor(Math.random()*EMOJIS.length)];
sessionStorage.setItem('vincle_color',sessionColor);
sessionStorage.setItem('vincle_emoji',sessionEmoji);
myColorEl.style.background=sessionColor;
myEmojiEl.textContent=sessionEmoji;

// --- Sala ---
let currentRoom=new URLSearchParams(window.location.search).get('room')||localStorage.getItem('vincle_room')||Math.random().toString(36).substring(2,9);
function setRoom(room){
  currentRoom=room;
  roomTitle.textContent=room;
  roomInput.value=room;
  localStorage.setItem('vincle_room',room);
  const url=new URL(window.location);
  url.searchParams.set('room',room);
  window.history.replaceState({},'',url);
  expiryLabel.textContent=MESSAGE_EXPIRY_HOURS+'h';
  listenToMessages();
}

// --- Firebase messages ---
function getMessagesRef(){ return db.ref('rooms/'+currentRoom+'/messages'); }
function sendMessage(text){ if(!text.trim())return;
  const now=Date.now();
  getMessagesRef().push({text:text.trim(),color:sessionColor,emoji:sessionEmoji,ts:now,expiry:now+MESSAGE_EXPIRY_HOURS*3600000});
  textInput.value=''; textInput.style.height='auto';
}
function createMessageBubble(msg,isMine){
  const b=document.createElement('div');
  b.className='message-bubble '+(isMine?'mine':'other');
  const time=new Date(msg.ts||Date.now());
  const t=formatTime(time);
  b.innerHTML=`<div class="message-sender"><span class="sender-emoji">${msg.emoji||'üë§'}</span><span class="sender-name">${isMine?'T√∫':'An√≥nimo'}</span></div>
  <div class="message-text">${escapeHtml(msg.text)}</div>
  <div class="message-time">${t}</div>`;
  return b;
}
function listenToMessages(){
  messagesEl.innerHTML='';
  getMessagesRef().limitToLast(100).on('child_added',s=>{
    const m=s.val(); if(!m)return; if(m.expiry && Date.now()>m.expiry)return;
    const mine=(m.color===sessionColor && m.emoji===sessionEmoji);
    messagesEl.appendChild(createMessageBubble(m,mine));
    setTimeout(()=>messagesEl.scrollTop=messagesEl.scrollHeight,100);
  });
}

// --- Util ---
function escapeHtml(t){const d=document.createElement('div');d.textContent=t;return d.innerHTML;}
function formatTime(d){const diff=Date.now()-d;if(diff<60000)return'Ahora';if(diff<3600000)return Math.floor(diff/60000)+' min';if(diff<86400000)return d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});return d.toLocaleDateString([],{month:'short',day:'numeric'});}

// --- Events ---
createBtn.addEventListener('click',()=>setRoom(roomInput.value.trim()||Math.random().toString(36).substring(2,9)));
copyBtn.addEventListener('click',()=>navigator.clipboard.writeText(window.location.href).then(()=>alert('Enlace copiado')));
sendBtn.addEventListener('click',()=>sendMessage(textInput.value));
textInput.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage(textInput.value);}});
textInput.addEventListener('input',function(){this.style.height='auto';this.style.height=this.scrollHeight+'px';});
newRoomBtn.addEventListener('click',()=>setRoom(Math.random().toString(36).substring(2,9)));
clearChatBtn.addEventListener('click',()=>{if(confirm('Limpiar chat local?')){messagesEl.innerHTML='';listenToMessages();}});
randomRoomBtn.addEventListener('click',()=>setRoom(Math.random().toString(36).substring(2,9)));
shareRoomBtn.addEventListener('click',()=>navigator.clipboard.writeText(window.location.href).then(()=>alert('Enlace copiado.')));
menuBtn.addEventListener('click',()=>sidePanel.classList.toggle('active'));

// --- Inicializar ---
document.addEventListener('DOMContentLoaded',()=>{ setRoom(currentRoom); setTimeout(()=>textInput.focus(),500); });
</script>
</body>
</html>

